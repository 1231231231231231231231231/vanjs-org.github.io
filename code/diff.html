<!DOCTYPE html>
<html>
  <head>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ¤–</text></svg>">
    <title>Diff App</title>
    <meta charset="UTF-8">
    <style>
      .row { display: flex; }

      .column {
        width: 500px;
        margin: 2px;
      }

      .column textarea {
        box-sizing: border-box;
        width: 100%;
      }

      .add { background-color: #B5EFDB; }
      .remove { background-color: #FFC4C1; }
      .merged .remove { text-decoration: line-through; }
    </style>
  </head>
  <body>
    <script type="text/javascript" src="diff.min.js"></script>
    <script type="text/javascript" src="van-latest.nomodule.min.js"></script>
    <script>
      const {button, div, input, span, textarea} = van.tags

      const autoGrow = e => {
        e.target.style.height = "5px"
        e.target.style.height = e.target.scrollHeight + "px"
      }

      const Result = ({diff, skipAdd, skipRemove}) => div({style: "white-space: pre-wrap;"},
        diff.filter(d => !(skipAdd && d.added || skipRemove && d.removed)).map(d =>
          span({class: d.added ? "add" : (d.removed ? "remove" : "")}, d.value)),
      )

      const DiffApp = () => {
        const oldTextDom = textarea({oninput: autoGrow})
        const newTextDom = textarea({oninput: autoGrow})
        const diff = van.state([])
        const showMerged = van.state(true)
        return div(
          div({class: "row"},
            div({class: "column"}, oldTextDom),
            div({class: "column"}, newTextDom),
          ),
          div({class: "row"},
            button({onclick: () => diff.val = Diff.diffWords(oldTextDom.value, newTextDom.value)},
              "Diff",
            ), " ",
            input({type: "checkbox", checked: showMerged,
              oninput: e => showMerged.val = e.target.checked}),
            "show merged result"
          ),
          van.bind(showMerged, showMerged => showMerged ?
            div({class: "row"},
              div({class: "column merged"}, van.bind(diff, diff => Result({diff}))),
            ) :
            div({class: "row"},
              div({class: "column"}, van.bind(diff, diff => Result({diff, skipAdd: true}))),
              div({class: "column"}, van.bind(diff, diff => Result({diff, skipRemove: true}))),
            ),
          ),
        )
      }

      document.body.appendChild(DiffApp())
    </script>
  </body>
</html>
